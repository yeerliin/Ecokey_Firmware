#include "wifi_provision_web_form.h"

const char *html_form =
    "<!DOCTYPE html><html lang='es'><head>"
    "<meta charset='UTF-8'><title>EcoKey Setup</title>"
    "<meta name='viewport' content='width=device-width, initial-scale=1'>"
    "<link href='https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap' rel='stylesheet'>"
    "<style>"
    "body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#f2f6f3 0%,#e7fff4 100%);margin:0;min-height:100vh;color:#333;}"
    "header{background:linear-gradient(90deg,#24b47e 80%,#27e2a1 100%);color:white;padding:1.5em 0;text-align:center;box-shadow:0 4px 15px #0002;position:relative;overflow:hidden;}"
    "header:before{content:'';position:absolute;top:-50%;right:-5%;width:80%;height:200%;background:rgba(255,255,255,0.1);transform:rotate(30deg);}"
    "header h1{margin:0;font-weight:600;font-size:1.8em;letter-spacing:0.5px;position:relative;}"
    "main{max-width:450px;background:white;margin:2.5em auto 3em;border-radius:24px;box-shadow:0 12px 45px rgba(36,180,126,0.15);padding:2.8em 2.5em 2em;animation:fadeIn 1.2s;transition:all 0.3s ease;}"
    "@media (max-width: 520px) {main{margin:1.5em auto;padding:1.8em 1.5em;border-radius:18px;}}"
    ".step{display:none;opacity:0;transform:translateY(10px);transition:opacity 0.5s,transform 0.5s;}"
    ".step.active{display:block;opacity:1;transform:translateY(0);}"
    "h2{color:#24b47e;font-weight:600;margin-top:0;margin-bottom:1em;font-size:1.5em;}"
    "p{line-height:1.5;color:#666;margin-bottom:1.2em;}"
    ".form-group{margin-bottom:1.5em;}"
    "label{display:block;margin-bottom:0.5em;font-weight:500;color:#555;}"
    "input, select{width:100%;padding:0.9em 1em;border:2px solid #e0e0e0;border-radius:12px;font-size:1em;font-family:'Poppins',sans-serif;transition:all 0.3s;box-sizing:border-box;}"
    "input:focus, select:focus{outline:none;border-color:#24b47e;box-shadow:0 0 0 3px rgba(36,180,126,0.15);}"
    "small{display:block;color:#888;margin-top:0.4em;font-size:0.85em;}"
    ".buttons{text-align:center;margin-top:2.5em;display:flex;justify-content:center;gap:1em;}"
    "button{background:linear-gradient(90deg,#24b47e 70%,#26b892 100%);color:white;border:none;padding:0.9em 2em;border-radius:12px;font-size:1em;font-weight:500;cursor:pointer;box-shadow:0 4px 15px rgba(36,180,126,0.2);transition:all 0.3s;font-family:'Poppins',sans-serif;}"
    "button[disabled]{background:#b4e0d2;cursor:default;box-shadow:none;opacity:0.7;}"
    "button:not([disabled]):hover{background:#1d9d6c;transform:translateY(-2px);box-shadow:0 6px 18px rgba(36,180,126,0.25);}"
    "button:not([disabled]):active{transform:translateY(0);}"
    "button.secondary{background:transparent;color:#24b47e;border:2px solid #24b47e;box-shadow:none;}"
    "button.secondary:hover{background:rgba(36,180,126,0.1);transform:translateY(-2px);}"
    ".error{color:#f44336;font-size:0.9em;margin-top:0.5em;min-height:1.2em;display:block;transition:all 0.3s;font-weight:500;}"
    ".loading{text-align:center;margin:1.5em 0;color:#24b47e;font-weight:500;position:relative;padding-bottom:1.2em;}"
    ".loading:after{content:'';display:block;width:30px;height:30px;border:3px solid #e0f2ea;border-radius:50%;border-top-color:#24b47e;animation:spin 0.8s linear infinite;position:absolute;left:calc(50% - 15px);bottom:-15px;}"
    "@keyframes spin{to{transform:rotate(360deg);}}"
    "@keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}"
    "@keyframes flotar{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}"
    "#msg{margin-top:2em;color:#159357;text-align:center;font-size:1.13em;min-height:2em;}"
    ".progress-bar{display:flex;justify-content:center;margin:0 auto 2.5em;}"
    ".progress-step{width:28px;height:28px;border-radius:50%;background:#e0f2ea;display:flex;align-items:center;justify-content:center;color:#24b47e;font-weight:600;margin:0 1em;position:relative;z-index:1;box-shadow:0 2px 8px rgba(36,180,126,0.1);}"
    ".progress-step.active{background:#24b47e;color:white;}"
    ".progress-step.done{background:#1d9d6c;color:white;}"
    ".progress-step.done:after, .progress-step.active:after{content:'';position:absolute;width:100%;height:4px;background:#24b47e;top:50%;left:100%;transform:translateY(-50%);z-index:-1;}"
    ".progress-step:last-child:after{display:none;}"
    ".success-icon{text-align:center;margin:1em 0 2em;font-size:3em;color:#24b47e;}"
    ".success-message{text-align:center;color:#159357;font-weight:500;margin-bottom:2em;line-height:1.6;}"
    ".logo-container{text-align:center;max-width:180px;margin:0 auto 2rem;animation:flotar 3s ease-in-out infinite;}"
    ".grupo-password{position:relative;}"
    ".grupo-password input{padding-right:45px;}"
    ".boton-password{position:absolute;right:0;top:0;height:100%;width:45px;background:none;border:none;cursor:pointer;color:#888;display:flex;align-items:center;justify-content:center;font-size:1.2rem;border-top-right-radius:12px;border-bottom-right-radius:12px;transition:all 0.3s;}"
    ".boton-password:hover{color:#24b47e;background-color:rgba(36,180,126,0.1);}"
    ".wifi-list{max-height:200px;overflow-y:auto;margin-bottom:1.5em;border:1px solid #e0e0e0;border-radius:12px;padding:0.5em;}"
    ".wifi-option{padding:0.8em;border-radius:8px;cursor:pointer;transition:all 0.3s;margin-bottom:0.3em;display:flex;align-items:center;justify-content:space-between;}"
    ".wifi-option:hover{background-color:#f5f5f5;}"
    ".wifi-option.selected{background-color:rgba(36,180,126,0.1);border:1px solid #24b47e;}"
    ".wifi-signal{display:inline-block;width:24px;text-align:center;margin-left:0.5em;}"
    ".wifi-name{flex-grow:1;font-weight:500;}"
    ".pulse{animation:pulse 1.5s infinite;}"
    "@keyframes pulse{0%{opacity:1}50%{opacity:0.5}100%{opacity:1}}"
    ".notification{padding:1em;border-radius:12px;margin-bottom:1em;display:flex;align-items:center;}"
    ".notification-success{background-color:rgba(6,214,160,0.15);border-left:4px solid #06d6a0;}"
    ".notification-error{background-color:rgba(244,67,54,0.15);border-left:4px solid #f44336;}"
    ".footer{text-align:center;font-size:0.8em;color:#888;margin-top:2em;}"
    ".welcome-container{text-align:center;margin-bottom:1.5rem;}"
    ".step-info{display:flex;align-items:center;margin:1.2rem 0;padding:0.8rem;border-radius:12px;background-color:rgba(36,180,126,0.08);}"
    ".step-icon{width:40px;height:40px;min-width:40px;background-color:#24b47e;border-radius:50%;color:white;display:flex;align-items:center;justify-content:center;margin-right:1rem;font-weight:600;font-size:1.2rem;}"
    ".step-text{flex-grow:1;line-height:1.4;font-size:0.95rem;}"
    ".estado-container{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:300px;padding:2rem 1rem;text-align:center;}"
    ".estado-icono{width:80px;height:80px;margin-bottom:1.5rem;position:relative;}"
    ".estado-icono svg{width:100%;height:100%;}"
    ".estado-titulo{margin:0.5rem 0 1rem;font-size:1.6rem;font-weight:600;color:#24b47e;}"
    ".estado-mensaje{margin-bottom:1.5rem;color:#666;max-width:320px;line-height:1.5;}"
    ".estado-progress{display:block;width:100%;height:4px;border-radius:2px;background:#e0e0e0;overflow:hidden;margin:1.5rem 0;}"
    ".estado-progress-bar{height:100%;width:0;background:linear-gradient(90deg,#24b47e 70%,#26b892 100%);transition:width 0.5s ease;}"
    ".estado-loading{position:relative;width:60px;height:60px;margin:1rem auto;}"
    ".estado-loading:before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;border-radius:50%;border:3px solid rgba(36,180,126,0.2);border-top-color:#24b47e;animation:spin 1.2s linear infinite;}"
    ".estado-pulsing{animation:pulse 2s infinite;}"
    ".estado-success-icon{display:inline-block;width:80px;height:80px;border-radius:50%;background:#24b47e;position:relative;animation:scaleIn 0.5s ease;}"
    ".estado-success-icon:after{content:'';position:absolute;top:50%;left:50%;width:40px;height:20px;margin-top:-2px;margin-left:-20px;border:4px solid white;border-top:0;border-right:0;transform:rotate(-45deg);transform-origin:center;}"
    ".estado-restart-icon{width:80px;height:80px;position:relative;border-radius:50%;background:#24b47e;animation:spin 3s ease infinite;}"
    ".estado-restart-icon:before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40%;height:40%;border-radius:50%;background:white;}"
    ".estado-restart-icon:after{content:'';position:absolute;top:15%;left:50%;transform:translateX(-50%);width:20%;height:35%;background:white;border-radius:30px;}"
    "@keyframes scaleIn{0%{transform:scale(0.1)}70%{transform:scale(1.1)}100%{transform:scale(1)}}"
    "@keyframes pulse{0%{opacity:1;transform:scale(1)}50%{opacity:0.6;transform:scale(0.95)}100%{opacity:1;transform:scale(1)}}"
    "</style></head><body>"
    "<header><h1>Asistente de configuraci√≥n</h1></header>"
    "<main>"
    "<div id='step0' class='step active'>"
    "<div class='logo-container'>"
    "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 350.65 269.99' width='180' height='140'>"
    "<style>.cls-1{fill:#8fd727}.cls-2{fill:#ffc336}.cls-3{fill:#162028}.cls-4{fill:#3a9617}.cls-5{fill:#fff}.cls-6{fill:#a0dc46}.cls-7{fill:#ff9700}.cls-8{fill:#18211e}.cls-10{fill:#a2de44}</style>"
    "<g><path class='cls-10' d='M171.98,169.55c-35.49,0-64.36-28.87-64.36-64.36s28.87-64.36,64.36-64.36c17.03,0,33.08,6.58,45.2,18.54,1.58,1.56,1.6,4.11,.04,5.69-1.56,1.58-4.11,1.6-5.69,.04-10.6-10.46-24.65-16.22-39.54-16.22-31.05,0-56.31,25.26-56.31,56.31s25.26,56.31,56.31,56.31c26.63,0,49.83-18.91,55.16-44.95,.45-2.18,2.57-3.59,4.75-3.14,2.18,.45,3.58,2.57,3.14,4.75-6.09,29.78-32.61,51.39-63.05,51.39Z'/>"
    "<path class='cls-5' d='M144.32,156.29s10.16,7.16,25.13,6.67,17.97-2.13,21.08-3.32l-2.84-.41s-13.16,4.12-27.47,1.08c-3.67-.85-9.11-2.45-14.77-5.46,0,0-1.14,1.44-1.14,1.44Z'/>"
    "<path class='cls-5' d='M128.53,153.84s-25.44-23.01-20.36-57.5c5.86-39.8,39.92-51.35,43.76-52.32l-1.62,3.74s-32.68,8.09-40.59,48.52c-3.76,22.55,8.47,45.41,19.52,55.47,0,.14-.71,2.1-.71,2.1Z'/>"
    "<path class='cls-5' d='M203.92,49.06c-3.07-1.78-5.63-2.75-8.68-3.91-.3.5-.68.87-.9,1.31,3.2,1.16,6.09,2.26,9.07,4.07,6.02,3.89,10.93,8.48,14.81,12.8.32-1.22.19-2.36-.73-3.63-2.52-2.59-7.65-7.2-13.57-10.64Z'/>"
    "<path class='cls-8' d='M233,107.97c-5.18-1.06-10.23,2.28-11.29,7.45-4.81,23.48-25.72,40.53-49.74,40.53-27.99,0-50.77-22.77-50.77-50.77s22.77-50.77,50.77-50.77c13.43,0,26.09,5.19,35.65,14.63,3.76,3.71,9.82,3.67,13.53-.09,3.71-3.76,3.67-9.82-.09-13.53-13.16-12.99-30.6-20.14-49.09-20.14-38.54,0-69.9,31.36-69.9,69.9s31.36,69.9,69.9,69.9c33.06,0,61.86-23.48,68.48-55.82,1.06-5.18-2.28-10.23-7.45-11.29ZM235.03,118.15c-6.09,29.78-32.61,51.39-63.05,51.39-35.49,0-64.36-28.87-64.36-64.36s28.87-64.36,64.36-64.36c17.03,0,33.08,6.58,45.2,18.54,1.58,1.56,1.6,4.11,.04,5.69-1.56,1.58-4.11,1.6-5.69,.04-10.6-10.46-24.65-16.22-39.54-16.22-31.05,0-56.31,25.26-56.31,56.31s25.26,56.31,56.31,56.31c26.63,0,49.83-18.91,55.16-44.95,.45-2.18,2.57-3.59,4.75-3.14,2.18,.45,3.58,2.57,3.14,4.75Z'/>"
    "<path class='cls-4' d='M187.7,159.22s6.31,1.98,6.07,3.73c-.37,2.72-17.04,6.16-30.27,6.05,0,0,10.2,2.27,26.17-1.83,5.84-1.5,18.93-7.31,20.06-10.89-15.06,1.71-22.02,2.94-22.02,2.94h0Z'/>"
    "<path class='cls-4' d='M147.43,155.9l-.69.6c-1.75,1.51-3.08,3.45-3.86,5.63l-.15.42-3.98-2.06,4.84-6.64,3.84,2.06Z'/>"
    "<g><path class='cls-3' d='M129.28,172.94c-.95,0-1.92-.25-2.78-.71-2.55-1.37-3.7-4.34-2.73-7.06l22.1-54.84h-16.05c-1.56,0-3-.78-3.85-2.08-.86-1.3-1-2.94-.37-4.37l29.06-65.93c.72-1.67,2.38-2.76,4.22-2.76h34.42c1.69,0,3.25,.93,4.05,2.41,.81,1.49,.73,3.29-.19,4.71l-28.39,42.05h18.92c1.75,0,3.33,.97,4.12,2.53,.79,1.57,.63,3.41-.41,4.82l-57.46,78.83c-1.14,1.52-2.83,2.38-4.65,2.38ZM133.75,103.15h15.91c1.51,0,2.93,.74,3.79,1.99,.86,1.24,1.06,2.83,.53,4.25l-19.38,48.09,48.06-65.93h-18.7c-1.69,0-3.25-.93-4.05-2.41-.81-1.49-.73-3.3,.19-4.71l28.39-42.05h-27.93l-26.8,60.78ZM158.71,39.59l-.21-.14,.21,.14Z'/>"
    "<path class='cls-5' d='M130.6,105.2h19.06c.84,0,1.63,.41,2.11,1.1s.59,1.57,.29,2.36l-23.49,58.27c-.15.43,.15,.68,.35,.78,.2,.1,.57,.22,.88-.2l56.88-78.03h-22.73c-.94,0-1.8-.51-2.25-1.34-.45-.83-.41-1.83,.11-2.62l30.53-45.22h-33.12l-28.6,64.88Z'/>"
    "<path class='cls-2' d='M165.01,43.42h24.65l-28.26,43.31,2.53,1h23.65l.67,2.31-58.28,78.47c-.44,.59-1.35,.05-1.04-.62l28.91-62.62-21.62-.08,28.78-61.78Z'/>"
    "<path class='cls-7' d='M186.93,43.44h4.99l-30.73,48.37h-3.6c-1.6,0-2.57-1.78-1.69-3.12l31.03-45.25Z'/>"
    "<path class='cls-7' d='M183.94,88.69s-49.8,70.51-55.01,79.02c1.54,4.79,59.33-77.67,59.33-77.67l-.67-2.31-3.64,.96Z'/>"
    "<polygon class='cls-5' points='185.88 91.93 159.55 91.82 162.17 88.84 187.99 89.04 185.88 91.93'/>"
    "<polygon class='cls-7' points='137.55 102.38 159.15 102.38 157.84 105.28 136.23 105.2 137.55 102.38'/></g>"
    "<g><path class='cls-5' d='M176.73,150.31c-13.99-11.96,.8-86.43,94.55-74.71,1.84,.23,3.07,1.91,2.69,3.65-14.53,66-65.32,84.2-97.24,71.06Z'/>"
    "<path class='cls-1' d='M184.29,153.7c-20.3-11.04,2.65-86.41,87.76-72.2,1.68,.28,2.4,2.38,1.93,4.02-18.11,62.61-60.25,80.8-89.68,68.19Z'/>"
    "<path class='cls-4' d='M271.49,82.01s-30.47,82.42-89.69,68.04c-5.07,.26-2.71,4.16-2.71,4.16,0,0,8.13,6.59,23.13,3.32s49.3-11.05,65.08-55.58c4.88-14.98,4.19-19.94,4.19-19.94Z'/>"
    "<path class='cls-5' d='M179.09,156.82c-.47,0-.95-.13-1.37-.39-1.23-.76-1.6-2.37-.84-3.6,25.12-40.51,70.8-58.45,72.74-59.2,1.35-.52,2.86,.15,3.38,1.5,.52,1.35-.15,2.86-1.5,3.38-.46,.18-46,18.1-70.17,57.08-.49,.8-1.35,1.24-2.22,1.24Z'/>"
    "<path class='cls-4' d='M180.1,140.3s25.81-38.52,68.15-46.23c-6.49,3.55-46.49,18.89-67.81,51.98l-.34-5.75Z'/>"
    "<path class='cls-3' d='M197.62,160.18c-7.61,0-15.05-1.46-21.92-4.4l-.39-.17-.32-.28c-7.32-6.51-7.24-24.34,.18-40.6,7.02-15.39,30.48-50.26,96.44-41.67,1.59,.21,3.04,1.08,3.97,2.39,.93,1.31,1.27,2.97,.94,4.54-7.25,34.29-24.47,60.03-48.48,72.5-9.85,5.11-20.3,7.7-30.43,7.7ZM178.18,151.16c14.49,6.04,31.75,4.84,47.46-3.31,22.59-11.73,38.85-36.21,45.77-68.94,.04-.2-.03-.35-.09-.44-.06-.09-.18-.2-.38-.23-62.52-8.14-84.48,24.33-91.02,38.66-6.71,14.72-6.29,29.64-1.74,34.25Z'/>"
    "<path class='cls-3' d='M176.73,155.99c-.5,0-1-.14-1.44-.44-1.2-.8-1.53-2.42-.73-3.62,30.53-45.91,73.42-58.05,75.23-58.59,1.38-.41,2.87-.59,3.21,.81,.25,1.04-1.07,1.5-2.45,1.91-.43,.13-42.21,14.49-71.64,58.75-.5,.76-1.33,1.17-2.18,1.17Z'/>"
    "<path class='cls-3' d='M234.08,125c-.15,0-.31-.01-.46-.04-.58-.1-14.32-2.62-20.17-10.04-.89-1.13-.7-2.77,.43-3.67,1.13-.89,2.77-.7,3.67,.43,3.83,4.86,13.56,7.52,16.99,8.14,1.42,.25,2.36,1.61,2.11,3.03-.23,1.26-1.33,2.15-2.57,2.15Z'/>"
    "<path class='cls-3' d='M210.09,118.56c-1.17,0-2.23-.79-2.53-1.97-2.19-8.6,3.87-20.08,4.13-20.56,.68-1.27,2.26-1.75,3.53-1.07,1.27,.68,1.75,2.26,1.07,3.53h0c-1.5,2.81-5.07,11.31-3.67,16.81,.36,1.4-.49,2.82-1.89,3.18-.22,.06-.43,.08-.65,.08Z'/>"
    "<path class='cls-3' d='M193.77,134.09c-1.08,0-2.1-.68-2.47-1.76-2.08-6.04-.96-14.81-.1-19.5,.26-1.42,1.62-2.36,3.04-2.1,1.42,.26,2.36,1.62,2.1,3.04-.62,3.37-1.86,11.77-.1,16.86,.47,1.36-.25,2.85-1.62,3.32-.28,.1-.57,.14-.85,.14Z'/>"
    "<path class='cls-3' d='M223.12,137.83c-.75,0-18.54-.11-26.03-9.38-.91-1.12-.73-2.77,.39-3.67,1.12-.91,2.77-.73,3.67,.39,5.92,7.33,21.81,7.44,21.97,7.44,1.44,0,2.61,1.17,2.61,2.61s-1.17,2.61-2.61,2.61Z'/></g></g>"
    "<g><path class='cls-3' d='M73.04,198.45h-16.46v9.02h14.55v8.39h-14.55v9.79h16.46v8.71h-27.33v-44.61h27.33v8.71Z'/>"
    "<path class='cls-3' d='M102.59,189.23c10.61,0,18.62,5.97,21.16,15.63h-11.95c-1.84-3.81-5.21-5.72-9.34-5.72-6.67,0-11.25,4.96-11.25,12.84s4.58,12.84,11.25,12.84c4.13,0,7.5-1.91,9.34-5.72h11.95c-2.54,9.66-10.55,15.57-21.16,15.57-13.16,0-22.43-9.34-22.43-22.69s9.28-22.75,22.43-22.75Z'/>"
    "<path class='cls-3' d='M153.43,234.8c-12.65,0-22.94-9.47-22.94-22.88s10.3-22.82,22.94-22.82,22.82,9.41,22.82,22.82-10.17,22.88-22.82,22.88ZM153.43,224.88c7.12,0,11.76-5.15,11.76-12.96s-4.64-12.96-11.76-12.96-11.82,5.02-11.82,12.96,4.58,12.96,11.82,12.96Z'/>"
    "<path class='cls-6' d='M195.06,214.65v19.7h-10.87v-44.61h10.87v19.57l14.87-19.57h12.77l-17.29,21.86,17.92,22.75h-13.28l-15-19.7Z'/>"
    "<path class='cls-6' d='M257.72,198.45h-16.46v9.02h14.55v8.39h-14.55v9.79h16.46v8.71h-27.33v-44.61h27.33v8.71Z'/>"
    "<path class='cls-6' d='M263.19,189.74h12.33l8.64,18.68,8.58-18.68h12.2l-15.44,29.87v14.74h-10.87v-14.74l-15.44-29.87Z'/></g>"
    "</svg>"
    "</div>"
    "<div class='welcome-container'>"
    "<h2>¬°Te damos la bienvenida!</h2>"
    "<p>Estamos a punto de configurar tu dispositivo de control energ√©tico inteligente. El proceso es r√°pido y sencillo.</p>"
    "</div>"
    "<div class='step-info'>"
    "<div class='step-icon'>1</div>"
    "<div class='step-text'>Configura el dispositivo Bluetooth que controlar√° tu equipo</div>"
    "</div>"
    "<div class='step-info'>"
    "<div class='step-icon'>2</div>"
    "<div class='step-text'>Conecta tu dispositivo a la red WiFi de tu hogar u oficina</div>"
    "</div>"
    "<div class='step-info'>"
    "<div class='step-icon'>3</div>"
    "<div class='step-text'>¬°Listo! Tu sistema de control energ√©tico inteligente estar√° operativo</div>"
    "</div>"
    "<div class='buttons'><button onclick='goStep(1)'>Comenzar</button></div>"
    "</div>"
    "<div id='step1' class='step'>"
    "<div class='progress-bar'>"
    "<div class='progress-step active'>1</div>"
    "<div class='progress-step'>2</div>"
    "<div class='progress-step'>3</div>"
    "</div>"
    "<h2>Datos del dispositivo</h2>"
    "<form id='form1' autocomplete='off' novalidate>"
    "<div class='form-group'>"
    "<label for='mac_objetivo'>MAC objetivo *</label>"
    "<input type='text' id='mac_objetivo' maxlength='17' placeholder='AA:BB:CC:DD:EE:FF' required oninput='validateStep1()'>"
    "<small>Formato: AA:BB:CC:DD:EE:FF</small>"
    "</div>"
    "<div class='form-group'>"
    "<label for='temporizador'>Temporizador (minutos) *</label>"
    "<input type='number' id='temporizador' min='1' max='30' placeholder='Introduce un valor entre 1-30' required oninput='validateStep1()'>"
    "</div>"
    "<span class='error' id='error1'></span>"
    "<div class='buttons'><button type='button' class='secondary' onclick='goStep(0)'>Atr√°s</button><button type='button' id='next1' onclick='saveStep1()' disabled>Siguiente</button></div>"
    "</form></div>"
    "<div id='step2' class='step'>"
    "<div class='progress-bar'>"
    "<div class='progress-step done'>1</div>"
    "<div class='progress-step active'>2</div>"
    "<div class='progress-step'>3</div>"
    "</div>"
    "<h2>Conexi√≥n WiFi</h2>"
    "<form id='form2' autocomplete='off' novalidate>"
    "<div class='form-group'>"
    "<label for='ssid'>Selecciona la red WiFi *</label>"
    "<select id='ssid'></select>"
    "<div class='loading' id='loading'>Buscando redes disponibles...</div>"
    "</div>"
    "<div class='form-group'>"
    "<label for='password'>Contrase√±a *</label>"
    "<div class='grupo-password'>"
    "<input type='password' id='password' placeholder='Contrase√±a de la red WiFi' required oninput='validateStep2()'>"
    "<button type='button' class='boton-password' id='toggle-password' aria-label='Mostrar/ocultar contrase√±a'>üëÅÔ∏è</button>"
    "</div>"
    "</div>"
    "<span class='error' id='error2'></span>"
    "<div class='buttons'><button type='button' class='secondary' onclick='goStep(1)'>Atr√°s</button><button type='submit' id='finalizar' disabled>Finalizar configuraci√≥n</button></div>"
    "</form></div>"
    "<div id='step3' class='step'>"
    "<div class='progress-bar'>"
    "<div class='progress-step done'>1</div>"
    "<div class='progress-step done'>2</div>"
    "<div class='progress-step active'>3</div>"
    "</div>"
    "<div class='estado-container' id='estado-configurando'>"
    "<div class='estado-icono'>"
    "<div class='estado-loading'></div>"
    "</div>"
    "<h2 class='estado-titulo'>Configurando dispositivo</h2>"
    "<p class='estado-mensaje'>Estamos aplicando la configuraci√≥n y conectando con la red WiFi. Este proceso puede tomar unos segundos...</p>"
    "<div class='estado-progress'>"
    "<div class='estado-progress-bar' id='progress-bar'></div>"
    "</div>"
    "</div>"
    "<div class='estado-container' id='estado-exito' style='display:none'>"
    "<div class='estado-icono'>"
    "<div class='estado-success-icon'></div>"
    "</div>"
    "<h2 class='estado-titulo'>¬°Configuraci√≥n exitosa!</h2>"
    "<p class='estado-mensaje'>Tu dispositivo ha sido configurado correctamente y est√° listo para funcionar.</p>"
    "<div class='notification notification-success' style='display:inline-flex; padding:0.8em 1.2em;'>"
    "<div id='countdown-text'>Reiniciando en 10 segundos...</div>"
    "</div>"
    "</div>"
    "<div class='estado-container' id='estado-reiniciando' style='display:none'>"
    "<div class='estado-icono'>"
    "<div class='estado-restart-icon'></div>"
    "</div>"
    "<h2 class='estado-titulo'>Reiniciando dispositivo</h2>"
    "<p class='estado-mensaje'>El dispositivo se est√° reiniciando para aplicar los cambios. El proceso ya esta completado.</p>"
    "<p class='estado-mensaje estado-pulsing' style='font-weight:500;color:#24b47e;'>Dispositivo, en funcionamiento</p>"
    "</div>"
    "<div class='estado-container' id='estado-error' style='display:none'>"
    "<div class='estado-icono'>"
    "<svg viewBox='0 0 24 24' fill='none' stroke='#f44336' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>"
    "<circle cx='12' cy='12' r='10'></circle>"
    "<line x1='15' y1='9' x2='9' y2='15'></line>"
    "<line x1='9' y1='9' x2='15' y2='15'></line>"
    "</svg>"
    "</div>"
    "<h2 class='estado-titulo' style='color:#f44336;'>Error de configuraci√≥n</h2>"
    "<p class='estado-mensaje' id='error-message'>No se pudo conectar con la red WiFi. Por favor, verifica la contrase√±a e int√©ntalo nuevamente.</p>"
    "<div class='buttons' id='resetBtn'><button onclick='goStep(2)'>Volver a intentar</button></div>"
    "</div>"
    "</div>"
    "<div class='footer'>EcoKey &copy; 2024 - Control energ√©tico inteligente</div>"
    "<script>"
    "let data = {};"
    "function goStep(n){"
    "let currentStep = document.querySelector('.step.active');"
    "currentStep.classList.remove('active');"
    "setTimeout(()=>{"
    "document.getElementById('step'+n).classList.add('active');"
    "},100);"
    "}"
    "function validateStep1(){"
    "let mac=document.getElementById('mac_objetivo').value.trim().toUpperCase();"
    "document.getElementById('mac_objetivo').value = mac;"
    "let temp=document.getElementById('temporizador').value.trim();"
    "let re=/^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$/;"
    "let valid=re.test(mac)&&temp>0;"
    "document.getElementById('next1').disabled=!valid;"
    "document.getElementById('error1').innerText=valid?'':'MAC v√°lida y temporizador obligatorio';"
    "let value = mac.replace(/[^0-9A-Fa-f:]/g, '');"
    "let digits = value.replace(/:/g, '');"
    "if(digits.length > 12) digits = digits.substring(0, 12);"
    "let formatted = '';"
    "for(let i = 0; i < digits.length; i++) {"
    "  if(i > 0 && i % 2 === 0 && i < 12) formatted += ':';"
    "  formatted += digits[i];"
    "}"
    "document.getElementById('mac_objetivo').value = formatted;"
    "}"
    "function saveStep1(){"
    "data.mac_objetivo=document.getElementById('mac_objetivo').value.trim();"
    "data.temporizador=document.getElementById('temporizador').value.trim();"
    "goStep(2); scanWiFi();"
    "}"
    "function scanWiFi(){"
    "document.getElementById('loading').style.display='block';"
    "let sel=document.getElementById('ssid');sel.innerHTML='';"
    "fetch('/scan').then(res=>res.json()).then(list=>{"
    "sel.innerHTML='';"
    "if(list.length === 0) {"
    "  document.getElementById('loading').textContent='No se encontraron redes WiFi. Intente de nuevo.';"
    "  return;"
    "}"
    "list.sort((a, b) => b.rssi - a.rssi);"
    "list.forEach(net=>{"
    "  let opt=document.createElement('option');"
    "  let signalStrength = '';"
    "  if(net.rssi > -60) signalStrength = 'üì∂ Excelente';"
    "  else if(net.rssi > -70) signalStrength = 'üì∂ Buena';"
    "  else if(net.rssi > -80) signalStrength = 'üì∂ Regular';"
    "  else signalStrength = 'üì∂ D√©bil';"
    "  opt.value=net.ssid;opt.text=net.ssid + ' (' + signalStrength + ')';"
    "  sel.appendChild(opt);"
    "});"
    "document.getElementById('loading').style.display='none';"
    "validateStep2();"
    "}).catch(()=>{document.getElementById('loading').textContent='Error al escanear redes WiFi';});"
    "}"
    "function validateStep2(){"
    "let pw=document.getElementById('password').value;"
    "document.getElementById('finalizar').disabled=pw.length<8;"
    "document.getElementById('error2').innerText=pw.length&&pw.length<8?'La contrase√±a debe tener m√≠nimo 8 caracteres.':'';"
    "}"
    "document.getElementById('toggle-password').addEventListener('click', function() {"
    "  const passwordInput = document.getElementById('password');"
    "  const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';"
    "  passwordInput.setAttribute('type', type);"
    "  this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üîí';"
    "});"
    "document.getElementById('form2').onsubmit=async function(e){"
    "e.preventDefault();"
    "data.ssid=document.getElementById('ssid').value;"
    "data.password=document.getElementById('password').value;"
    "if(!data.ssid||data.password.length<8){"
    "document.getElementById('error2').innerText='Completa todos los campos y pon una contrase√±a v√°lida.';"
    "return;"
    "}"
    "goStep(3);"
    "const progressBar = document.getElementById('progress-bar');"
    "let progress = 0;"
    "const progressInterval = setInterval(() => {"
    "  progress += Math.random() * 15;"
    "  if (progress > 90) {"
    "    progress = 90;"
    "    clearInterval(progressInterval);"
    "  }"
    "  progressBar.style.width = progress + '%';"
    "}, 500);"
    "try{"
    "let r=await fetch('/custom-data',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});"
    "let resp=await r.json();"
    "if(resp.success){"
    "  clearInterval(progressInterval);"
    "  progressBar.style.width = '100%';"
    "  setTimeout(() => {"
    "    document.getElementById('estado-configurando').style.display = 'none';"
    "    document.getElementById('estado-exito').style.display = 'flex';"
    "    let countdown = 10;"
    "    const countdownElement = document.getElementById('countdown-text');"
    "    const countdownInterval = setInterval(() => {"
    "      countdown--;"
    "      if (countdown <= 0) {"
    "        clearInterval(countdownInterval);"
    "        document.getElementById('estado-exito').style.display = 'none';"
    "        document.getElementById('estado-reiniciando').style.display = 'flex';"
    "      } else {"
    "        countdownElement.textContent = `Reiniciando en ${countdown} segundos...`;"
    "      }"
    "    }, 1000);"
    "  }, 1000);"
    "}else{"
    "  clearInterval(progressInterval);"
    "  document.getElementById('estado-configurando').style.display = 'none';"
    "  document.getElementById('estado-error').style.display = 'flex';"
    "  document.getElementById('error-message').innerText = resp.message || 'No se pudo conectar. Intenta de nuevo.';"
    "}"
    "}catch(err){"
    "  clearInterval(progressInterval);"
    "  document.getElementById('estado-configurando').style.display = 'none';"
    "  document.getElementById('estado-error').style.display = 'flex';"
    "  document.getElementById('error-message').innerText = 'Error de red o conexi√≥n con el dispositivo.';"
    "}"
    "};"
    "</script></main></body></html>";
